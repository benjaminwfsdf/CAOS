<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover" />
  <title>CAOS - Mis Cartas</title>

  <!-- PWA (ALUMNO) -->
  <link rel="manifest" href="/estudiante/manifest.json">
  <meta name="theme-color" content="#0b0b0c">

  <!-- iOS / √≠cono y nombre del alumno -->
  <link rel="apple-touch-icon" href="/estudiante/icons/icon-alumno-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="CAOS Alumno">

  <!-- Fuentes -->
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Rock+Salt&family=Comic+Neue:wght@700&display=swap" rel="stylesheet">

  <style>
    :root{
      --ink:#000; --paper:#fff; --shadow:8px 8px 0 var(--ink);
      --radius:18px; --gap:12px; --pad:14px;
      --fz-title:clamp(22px,5.6vw,32px);
      --fz-sub:clamp(16px,4.2vw,22px);
      --fz-body:clamp(14px,3.8vw,18px);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      padding:env(safe-area-inset-top) env(safe-area-inset-right) calc(16px + env(safe-area-inset-bottom)) env(safe-area-inset-left);
      background:var(--paper); color:var(--ink);
      -webkit-tap-highlight-color:transparent;
      font-family:'Rock Salt',cursive; font-weight:700; text-shadow:0 0 1px var(--ink);
      min-height:100dvh;
    }
    #splash{position:fixed; inset:0; z-index:99999; display:flex; align-items:center; justify-content:center; background:#fff; transition:opacity .35s ease, visibility .35s ease;}
    #splash.is-hidden{opacity:0; visibility:hidden;}
    .splash-wrap{display:flex; flex-direction:column; align-items:center; gap:20px; animation:splashIn 1200ms ease forwards;}
    .logo-card{width:210px; height:210px; background:#fff; border:4px solid #000; border-radius:26px; box-shadow:16px 16px 0 #000; display:grid; place-items:center; overflow:hidden;}
    .logo-bg{width:100%; height:100%; background-image:url("/estudiante/icons/icon-alumno-192.png"); background-position:center; background-repeat:no-repeat; background-size:120% 120%;}
    .brand{ font-family:'Rock Salt', cursive; font-size:32px; letter-spacing:1px; }
    @keyframes splashIn{0%{transform:translateY(6px) scale(.86); opacity:0;}45%{transform:translateY(0) scale(1.06); opacity:1;}70%{transform:translateY(0) scale(.98);}100%{transform:translateY(0) scale(1);} }
    @media (min-width:800px){ .carta{ grid-template-columns:240px 1fr; align-items:center } .carta img{ width:240px } .boton-canje{ min-width:200px } }
    .app{ max-width:900px; margin:0 auto; display:grid; gap:var(--gap); padding:12px; }
    .panel{ background:var(--paper); border:3px solid var(--ink); border-radius:var(--radius); padding:var(--pad); box-shadow:var(--shadow); position:relative; }
    .titulo{ font-size:var(--fz-title); text-align:center; border:3px dashed var(--ink); border-radius:14px; padding:10px 12px; margin:0 0 6px 0; background:var(--paper); }
    .subtitulo{ font-size:var(--fz-sub); text-align:center; margin:4px 0 14px 0; }
    .textin,.btn{ width:100%; min-height:48px; border:2px solid var(--ink); border-radius:12px; font-family:Arial, Helvetica, sans-serif; font-weight:700; font-size:var(--fz-body); padding:12px 14px; background:var(--paper); color:var(--ink); box-shadow:3px 3px 0 var(--ink); }
    .btn{ cursor:pointer }
    .btn:disabled{ background:#efefef; color:#9c9c9c; cursor:not-allowed }
    .carta{ display:grid; grid-template-columns:1fr; gap:10px; border:2px solid var(--ink); border-radius:14px; padding:12px; background:var(--paper); box-shadow:4px 4px 0 var(--ink); }
    .carta img{ width:100%; max-width:320px; height:auto; place-self:center; border-radius:12px; }
    .carta-row{ display:flex; align-items:center; gap:10px; justify-content:space-between; flex-wrap:wrap; }
    .carta-info{ font-family:Arial, sans-serif; font-size:var(--fz-body); flex:1; min-width:180px; }
    .cantidad{ font-weight:700; font-size:clamp(18px,5vw,28px); margin-top:4px }
    .boton-canje{ min-width:160px }
    .descripcion{ display:none; font-family:Arial, sans-serif; font-size:clamp(16px,4.6vw,20px); line-height:1.35; margin-top:6px; color:var(--ink); }
    footer{ border:3px solid var(--ink); border-radius:14px; box-shadow:4px 4px 0 var(--ink); padding:12px; text-align:center; font-family:Arial, sans-serif; font-weight:700; font-size:12px; background:var(--paper); max-width:600px; margin:4px auto 0; }
    #sugerencias{ display:none; margin-top:8px }
    .sug{ display:inline-block; margin:4px 6px 0 0; padding:6px 10px; border:2px solid var(--ink); background:var(--paper); box-shadow:3px 3px 0 var(--ink); cursor:pointer; border-radius:999px; font-family:Arial,sans-serif; font-weight:700; font-size:14px; }
  </style>
</head>
<body>

  <div id="splash"><div class="splash-wrap"><div class="logo-card"><div class="logo-bg"></div></div><div class="brand">CAOS</div></div></div>

  <main class="app">
    <section class="panel" id="loginPanel" style="margin-top:6px;">
      <h1 class="titulo">üîê Ingreso restringido</h1>
      <div id="alumnoWrap" style="display:grid; margin:6px 0; gap:10px;">
        <input id="alumnoNombre" class="textin" type="text" placeholder="Ingresa tus dos nombres y dos apellidos" autocomplete="off" autocorrect="off" autocapitalize="none" spellcheck="false">
        <div id="sugerencias"></div>
        <button type="button" class="btn" style="width:auto; justify-self:start" onclick="localStorage.removeItem('alumno');document.getElementById('alumnoNombre').value='';document.getElementById('sugerencias').style.display='none';">Limpiar nombre guardado</button>
      </div>
      <form id="loginForm" style="display:grid; gap:10px;">
        <input type="password" id="password" class="textin" placeholder="Ingresa tu contrase√±a" required autocomplete="off">
        <button type="submit" class="btn" id="btnEntrar">Entrar</button>
      </form>
      <div id="mensajeLogin" style="color:#e02424;margin-top:8px;text-align:center;font-family:Arial,sans-serif;font-weight:700;"></div>
    </section>

    <section class="panel" id="cartasPanel" style="display:none;">
      <h2 class="titulo">CAOS (Cartas Anti Orden en la Sala)</h2>
      <p class="subtitulo" id="nombreAlumno">Cargando estudiante...</p>
      <div id="cartasContainer" style="display:grid; gap:12px;">Cargando cartas...</div>
    </section>
  </main>

  <footer>¬© 2025 CAOS. Todos los derechos reservados. ‚Äî Desarrollado por Benjam√≠n Gonz√°lez ‚Äî Ilustraciones: Constanza Cayul.</footer>

  <script>
  // ... (todo el c√≥digo original previo intacto) ...

  async function cargarCartas(alumno) {
    const api = apiCartas;
    document.getElementById("nombreAlumno").innerText = alumno;
    try {
      const resCartas = await fetch(`${api}?alumno=${encodeURIComponent(alumno)}`, { cache: "no-store" });
      const dataCartas = await resCartas.json();
      const resImagenes = await fetch(`${api}?accion=imagenes`, { cache: "force-cache" });
      const dataImagenes = await resImagenes.json();
      const conteo = dataCartas.conteo || {};
      const contenedor = document.getElementById("cartasContainer");
      contenedor.innerHTML = "";
      const nombres = Object.keys(conteo);
      if (!nombres.length) {
        contenedor.innerHTML = "<p style='text-align:center;font-family:Arial,sans-serif;'>üì≠ No tienes cartas todav√≠a.</p>";
        return;
      }

      nombres.forEach((nombre) => {
        const cantidad = conteo[nombre];
        const carta = dataImagenes.find(img => img.Nombre === nombre);
        const div = document.createElement("div"); div.className = "carta";
        const img = new Image(); img.alt = nombre; img.loading = "lazy"; const PLACEHOLDER="https://i.imgur.com/U3F4gA1.png";
        const rawURL = carta?.["URL P√∫blica"] || "";
        const normalizedBase = normalizarImgur(rawURL);

        // === BLOQUE NUEVO DE IM√ÅGENES ESPECIALES ===
        if (nombre === "Pac-Man Arcade") {
          const PACMAN_ID="DGuyJYb";
          const candidates=[`https://i.imgur.com/${PACMAN_ID}.png`,`https://i.imgur.com/${PACMAN_ID}.jpg`,`https://i.imgur.com/${PACMAN_ID}.webp`,rawURL];
          tryImageCandidates(img,candidates,PLACEHOLDER);
        } else if (nombre.includes("Bodoque")) {
          const BODOQUE_ID="YiXHOY3";
          const candidates=[`https://i.imgur.com/${BODOQUE_ID}.png`,`https://i.imgur.com/${BODOQUE_ID}.jpg`,`https://i.imgur.com/${BODOQUE_ID}.webp`,rawURL];
          tryImageCandidates(img,candidates,PLACEHOLDER);
        } else {
          const candidates=[];
          if(normalizedBase&&/^https?:\/\/i\.imgur\.com\/[A-Za-z0-9]+$/i.test(normalizedBase)){
            candidates.push(`${normalizedBase}.png`,`${normalizedBase}.jpg`,`${normalizedBase}.webp`);
          }
          if(rawURL) candidates.unshift(rawURL);
          tryImageCandidates(img,candidates,PLACEHOLDER);
        }
        // === FIN BLOQUE NUEVO ===

        const descripcionTxt = obtenerDescripcion(nombre);
        const info=document.createElement("div");
        info.className="carta-info";
        info.innerHTML=`<div><strong>${nombre}</strong></div><div class="cantidad">Cantidad: ${cantidad}</div>`;
        const boton=document.createElement("button");
        boton.className="btn boton-canje"; boton.innerText="Solicitar Canje";
        boton.disabled=cantidad<1;
        boton.onclick=async()=>{const ok=confirm(`¬øConfirmas solicitar el canje de '${nombre}'?`); if(!ok)return;
          await fetch(`${api}?accion=solicitar_canje&alumno=${encodeURIComponent(alumno)}&carta=${encodeURIComponent(nombre)}`);
          alert("Solicitud enviada al profesor.");};
        const descripcion=document.createElement("div");
        descripcion.className="descripcion"; descripcion.innerText=descripcionTxt;
        const toggle=()=>{descripcion.style.display=descripcion.style.display==="block"?"none":"block";};
        habilitarDobleToque(div,toggle);
        div.append(img,info,boton,descripcion);
        contenedor.appendChild(div);
      });
    } catch(e){ document.getElementById("cartasContainer").innerText="Error al cargar cartas."; }
  }

  function obtenerDescripcion(nombre){
    switch(nombre){
      case "Juan Carlos Bodoque": 
      case "Juan Carlos Bodoque ‚Äî Reportaje Verde": 
        return "Si respondes una pregunta de la clase recuperas una carta canjeada.";
      case "Pac-Man Arcade": 
        return "Si ganas el Pac-Man (Nivel 1), puedes elegir cualquier carta del mazo.";
      default: return "Sin descripci√≥n disponible para esta carta.";
    }
  }
  </script>
</body>
</html>
