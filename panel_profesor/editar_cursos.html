<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Editar Cursos Asignados</title>
  <link href="https://fonts.googleapis.com/css2?family=Rock+Salt&family=Comic+Neue:wght@400;700&display=swap" rel="stylesheet">

  <!-- PWA -->
  <link rel="manifest" href="../manifest.json">
  <meta name="theme-color" content="#0b0b0c">
  <link rel="apple-touch-icon" href="../icons/apple-touch-icon.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="CAOS">

  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">

  <style>
    :root{ --ink:#000; --paper:#fff; --shadow:8px 8px 0 var(--ink); --r:18px; --pad:16px; }
    *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    html,body{ max-width:100%; overflow-x:hidden; }
    body{
      margin:0;
      padding:env(safe-area-inset-top) 12px calc(16px + env(safe-area-inset-bottom)) 12px;
      background:var(--paper);
      color:var(--ink);
      background-image:repeating-linear-gradient(45deg, rgba(0,0,0,.12) 0px, rgba(0,0,0,.12) 1px, transparent 1px, transparent 6px);
      background-attachment:fixed;
      font-family:'Rock Salt',cursive;
    }
    .panel{max-width:900px;margin:14px auto;background:var(--paper);border:3px solid var(--ink);
      border-radius:var(--r);box-shadow:var(--shadow);padding:var(--pad)}
    .panel.caos-relative{position:relative}
    h1{
      font-size:clamp(22px,6.8vw,32px); font-weight:700; text-align:center;
      border:3px dashed var(--ink); border-radius:14px; padding:12px; margin:0 0 12px 0;
      background:var(--paper); clip-path:polygon(0 0,90% 0,100% 10%,100% 90%,90% 100%,0 100%);
    }

    label{ display:block; font-family:'Comic Neue',cursive; font-size:16px; font-weight:700; margin:10px 0 6px; }
    #correo{
      width:100%; font-size:18px; padding:12px; border:2px solid var(--ink);
      background-color:#e6f0ff; margin-top:2px; box-shadow:3px 3px 0 var(--ink); min-height:44px;
      border-radius:12px; font-family:'Comic Neue',cursive;
    }
    .grilla-cursos{
      display:grid; grid-template-columns:repeat(auto-fill,minmax(170px,1fr));
      gap:10px; margin:14px 0 6px; 
    }
    .tarjeta-curso{
      border:2px solid var(--ink); padding:10px; background:#fff; box-shadow:4px 4px 0 var(--ink);
      cursor:pointer; display:flex; align-items:center; gap:8px; border-radius:14px;
      font-family:'Comic Neue',cursive;
    }
    .tarjeta-curso:hover{ transform: translateY(-1px); }
    .tarjeta-curso input{ margin-right:2px; transform:scale(1.18); }
    .btn{
      display:block; width:100%; max-width:460px; margin:10px auto 0; padding:14px 20px;
      font-size:18px; background:#fff; border:3px solid var(--ink); cursor:pointer; 
      box-shadow:4px 4px 0 var(--ink); font-family:'Comic Neue',cursive; min-height:48px; border-radius:14px;
      font-weight:700; letter-spacing:.2px;
    }
    .btn:active{ transform: translateY(1px); box-shadow:3px 3px 0 var(--ink); }
    .row-actions{ display:grid; gap:10px; grid-template-columns:1fr; margin-top:14px; }

    .status{
      margin:12px 0 0; padding:10px; border:2px dashed var(--ink); background:#f6f6f6;
      font:700 13px/1.3 Arial, sans-serif; border-radius:12px; text-align:center; display:none;
    }

    footer{max-width:700px;margin:10px auto 18px;padding:12px;background:var(--paper);
      border:3px solid var(--ink);border-radius:14px;box-shadow:4px 4px 0 var(--ink);
      text-align:center;font:700 12px/1.3 Arial, sans-serif}
    :focus-visible{ outline:3px dashed var(--ink); outline-offset:2px; }

    /* Globos / Onomato */
    .bubble{position:absolute;z-index:999;max-width:320px;background:#fff;color:#000;border:3px solid #000;
      box-shadow:6px 6px 0 #000;padding:12px 14px;font-weight:700;line-height:1.2;border-radius:14px;
      transform:translate(-50%,-110%) scale(.98);opacity:0;pointer-events:none;
      animation:bubble-in .25s ease-out forwards, bubble-out 3s 2.4s ease-in forwards}
    .bubble::after{content:"";position:absolute;bottom:-18px;left:50%;transform:translateX(-50%) rotate(8deg);
      width:24px;height:24px;background:#fff;border-left:3px solid #000;border-bottom:3px solid #000;
      box-shadow:6px 6px 0 #000;clip-path:polygon(0 0,100% 0,100% 100%)}
    .bubble--ok{border-color:#09b37a;box-shadow:6px 6px 0 #09b37a}
    .bubble--warn{border-color:#f59e0b;box-shadow:6px 6px 0 #f59e0b}
    .bubble--error{border-color:#e02424;box-shadow:6px 6px 0 #e02424}
    @keyframes bubble-in{to{opacity:1;transform:translate(-50%,-110%) scale(1)}}
    @keyframes bubble-out{to{opacity:0;transform:translate(-50%,-130%) scale(.96)}}
    .onomato{position:absolute;z-index:998;font-weight:900;letter-spacing:2px;font-size:28px;color:#33e6a4;
      -webkit-text-stroke:2px #000;text-shadow:6px 6px 0 #09b37a;transform:translate(-50%,-50%) scale(.6) rotate(-6deg);
      opacity:0;pointer-events:none;animation:ono-pop 520ms ease-out forwards}
    .onomato--error{color:#ff6b6b;text-shadow:6px 6px 0 #e02424}
    .onomato--wow{color:#ffd45a;text-shadow:6px 6px 0 #f59e0b}
    @keyframes ono-pop{20%{opacity:1;transform:translate(-50%,-50%) scale(1.1) rotate(2deg)}
      60%{transform:translate(-50%,-54%) scale(1) rotate(-2deg)}
      100%{opacity:0;transform:translate(-50%,-60%) scale(.9) rotate(0)}}
  </style>
</head>
<body>
  <div class="panel caos-relative">
    <h1>Editar Cursos Asignados</h1>

    <label for="correo">Tu correo (profesor):</label>
    <input type="text" id="correo" readonly />

    <label>Selecciona los cursos que tienes a cargo:</label>
    <div class="grilla-cursos" id="listaCursos"></div>

    <button class="btn" id="btnGuardar">Guardar cambios</button>
    <button class="btn" id="btnVolver">⬅ Volver al menú principal</button>
  </div>

  <footer>© 2025 CAOS. Todos los derechos reservados.<br>Sitio desarrollado por Benjamín González.</footer>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const usuario = urlParams.get("usuario") || "";
    document.getElementById("correo").value = usuario;

    const listaCursos = document.getElementById("listaCursos");
    const btnGuardar = document.getElementById("btnGuardar");
    const btnVolver = document.getElementById("btnVolver");

    const niveles = ["1ro Básico","2do Básico","3ro Básico","4to Básico","5to Básico","6to Básico","7mo Básico","8vo Básico","1ro Medio","2do Medio","3ro Medio","4to Medio","5to Medio"];
    const letras = ["A","B","C"];
    const cursos = niveles.flatMap(n => letras.map(l => `${n} ${l}`));

    cursos.forEach(curso => {
      const div = document.createElement("label");
      div.className = "tarjeta-curso";
      div.innerHTML = `<input type="checkbox" value="${curso}"> ${curso}`;
      listaCursos.appendChild(div);
    });

    async function guardarCambios() {
      const seleccionados = Array.from(document.querySelectorAll(".tarjeta-curso input:checked")).map(i=>i.value);
      if (!usuario) return;
      if (!confirm(`Actualizar cursos a:\n${seleccionados.join('\n')||'ninguno'}`)) return;
      const query = new URLSearchParams({accion:'editar_cursos_profesor', usuario, cursos: seleccionados.join(',')});
      try {
        const res = await fetch(`https://script.google.com/macros/s/AKfycbwDNPLxj452NmqmQotRwRNxCiSBe_ugF2YNCiC-HadLS-z4y29US0jmqeMlCu5Y7dfwnQ/exec?${query}`);
        const data = await res.json();
        alert(data.ok ? "✅ Cursos actualizados" : "❌ Error al actualizar");
      } catch { alert("❌ Error de red"); }
    }

    btnGuardar.onclick = guardarCambios;
    btnVolver.onclick = ()=> window.location.href=`../index.html?usuario=${encodeURIComponent(usuario)}`;
  </script>
</body>
</html>
